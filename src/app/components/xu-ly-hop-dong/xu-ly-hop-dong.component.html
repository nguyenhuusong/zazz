<div class="main-grid">
    <section class="bread-crumb">
        <app-hrm-breadcrumb [items]="items" ></app-hrm-breadcrumb>
    </section>
    <section class="bread-filter">
        <div class="d-flex bet end bottom gap-16">
            <div class="col-item">
                <div class="d-flex align-items-center gap-16">
                    <div class="filter filter-search">
                        <div class="field-group text search mb-0" [ngClass]=" query.filter ? 'valid' : 'invalid' ">
                            <input placeholder="" class="input-default" type="text" autocomplete="off" id="filter"
                                (click)="op.toggle($event)" (keydown.enter)="query.offSet = 0; first = 0;load()"
                                [(ngModel)]="query.filter">
                                <span class="placeholder-icon" (click)="query.offSet = 0; first = 0; load()">
                                    <svg width="19" height="20" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.02893 0.850098C4.51087 0.850098 0.849609 4.51552 0.849609 9.03539C0.849609 13.5553 4.51087 17.2207 9.02893 17.2207C10.8456 17.2207 12.5254 16.6271 13.8828 15.6241L17.1276 18.8716C17.4984 19.2427 18.0999 19.243 18.4711 18.8721C18.8422 18.5013 18.8425 17.8998 18.4716 17.5286L15.2709 14.3252C16.4787 12.8991 17.2083 11.0518 17.2083 9.03539C17.2083 4.51552 13.547 0.850098 9.02893 0.850098ZM2.74961 9.03539C2.74961 5.56338 5.56169 2.7501 9.02893 2.7501C12.4962 2.7501 15.3083 5.56338 15.3083 9.03539C15.3083 10.8568 14.5355 12.496 13.2976 13.645C12.1765 14.6858 10.6778 15.3207 9.02893 15.3207C5.56169 15.3207 2.74961 12.5074 2.74961 9.03539Z" fill="#2B2F33" fill-opacity="0.6"/>
                                        </svg>
                                </span>
                            <p-overlayPanel #op [style]="{width: '700px'}" styleClass="advance-seach">
                                <ng-template pTemplate>
                                    <div class="header-filter-search  grid">
                                        <h3>Tìm kiếm nâng cao</h3>
                                    </div>
                                    <div class="header-filter-search grid mt-1">
                                        <div class="icon col-12 pl-0" style="display: flex; flex-wrap: wrap;">
                                            <div class="col-6">
                                                <div class="field-group select valid">
                                                    <label for="organizeId"> Tổ chức: </label>
                                                    <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" [filter]="true"
                                                    [options]="listOrgRoots" [(ngModel)]="query.organizeId" name="organizeId"
                                                    (onChange)="getContractTypes();find()" inputId="organizeId">
                                                    <ng-template let-item pTemplate="selectedItem">
                                                        <span>{{item.label}}</span>
                                                    </ng-template>
                                                    <ng-template let-car pTemplate="item">
                                                        <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                                            <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                                                        </div>
                                                    </ng-template>
                                                </p-dropdown>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="field-group select label-8 valid">
                                                    <label for=""> Trạng thái: </label>
                                                    <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" [filter]="true"
                                                    [options]="statusContracts" [(ngModel)]="query.contract_st" name="contract_st"
                                                    (onChange)="find()">
                                                    <ng-template let-item pTemplate="selectedItem">
                                                        <span>{{item.label}}</span>
                                                    </ng-template>
                                                    <ng-template let-car pTemplate="item">
                                                        <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                                            <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                                                        </div>
                                                    </ng-template>
                                                </p-dropdown>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="field-group select label-8 valid">
                                                    <label for="contractTypeId"> Loại hợp đồng: </label>
                                                    <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" [filter]="true"
                                                    [options]="typeContracts" [(ngModel)]="query.contractTypeId" name="contractTypeId"
                                                    (onChange)="find()" [disabled]="!query.organizeId" inputId="contractTypeId">
                                                    <ng-template let-item pTemplate="selectedItem">
                                                        <span>{{item.label}}</span>
                                                    </ng-template>
                                                    <ng-template let-car pTemplate="item">
                                                        <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                                            <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                                                        </div>
                                                    </ng-template>
                                                </p-dropdown>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="field-group date mb-0 valid">
                                                    <label>Từ ngày</label>
                                                    <p-calendar (onSelect)="find()" panelStyleClass="datepicker-default" placeholder="DD/MM/YYYY"
                                                        [appendTo]="'body'" [baseZIndex]="101" [(ngModel)]="query.fromDate" [monthNavigator]="true"
                                                        [yearNavigator]="true" yearRange="2010:2030" inputId="navigators" dateFormat="dd/mm/yy"
                                                        name="fromDate"></p-calendar>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="field-group date mb-0 valid">
                                                    <label>Đến ngày</label>
                                                    <p-calendar (onSelect)="find()" panelStyleClass="datepicker-default" placeholder="DD/MM/YYYY"
                                                        [appendTo]="'body'" [baseZIndex]="101" [(ngModel)]="query.toDate" [monthNavigator]="true"
                                                        [yearNavigator]="true" yearRange="2010:2030" inputId="navigators" dateFormat="dd/mm/yy"
                                                        name="toDate"></p-calendar>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="input-group icon col-12 select-default text-right">
                                            <label for="" style="visibility: hidden;">Classid <span class="pi pi-info-circle"
                                                    style="font-size: 13px;color: orange;"></span></label>
                                            <p-button label="Tìm kiếm" styleClass="mr-1" icon="pi pi-search" (click)="load()">
                                            </p-button>
                                            <p-button label="Làm mới" icon="pi pi-times" (click)="cancel()"
                                                styleClass="p-button-secondary">
                                            </p-button>
                                        </div>
                                    </div>
                                </ng-template>
                            </p-overlayPanel>
                        </div>
                    </div>
                 
                    <p-button (click)="menuButton.toggle($event)" label="Tiện ích" icon="pi pi-cog"
                        styleClass="p-button-sm height-56 ml-1"> </p-button>
                    <p-button (onClick)="Prints()"  *ngIf="this.listPrints.length > 0" label="PRINT" icon="pi pi-print" styleClass="p-button-sm height-56"
                        [disabled]="isShowbtnPheDuyet">
                    </p-button>
                    <p-button class="" *ngIf="this.listPrints.length === 0" (click)="DowloadPlugin()" label="Cài plugin"
                        styleClass="p-button-sm height-56"></p-button>
                    <p-button (click)="pheDuyetHopDong()" label="Phê duyệt" [disabled]="isShowbtnPheDuyet"
                        icon="pi pi-cog" styleClass="p-button-sm height-56"> </p-button>
                        <p-button styleClass="p-button-sm h-56" (click)="cauhinh()">
                            <svg width="20" height="14px" viewBox="0 0 20 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M19.5 17V0H0.50855L0.5 17H19.5ZM6.675 15.3187H2.21V6.81868H6.675V15.3187ZM8.575 15.3187V6.81868H17.79V15.3187H8.575ZM2.21 1.68132V5.13736H17.79V1.68132H2.21Z" fill="white"/>
                                </svg>&nbsp;
                                Cấu hình 
                        </p-button>
                </div>
            </div>
        </div>
        <p-menu [model]="itemsToolOfGrid" [appendTo]="'body'" [popup]="true"
            styleClass="menu-option-right height-56" #menuButton></p-menu>
    </section>
    <section class="content pb-0">
        <div class="grid-default" #container>
            <app-list-grid-angular *ngIf="columnDefs.length > 0" [listsData]="listsData" [height]="heightGrid"
                [rowSelection]="'multiple'" (callback)="rowSelected($event)" [columnDefs]="columnDefs">
            </app-list-grid-angular>
            <div class="paginator">
                <span>Từ {{ countRecord.currentRecordStart }} đến
                    {{ countRecord.currentRecordEnd }}
                    trên tổng số
                    {{ countRecord.totalRecord }} kết quả</span>
                <p-paginator [rows]="query.pageSize" [totalRecords]="countRecord.totalRecord" [first]="first"
                    (onPageChange)="paginate($event)" [rowsPerPageOptions]="[15,30,45,100,200,{ showAll: 'ALL' }]">
                </p-paginator>
            </div>
        </div>
    </section>
</div>

<p-dialog [(visible)]="displayPrint" [baseZIndex]="99" [modal]="true" [style]="{width: '1400px', height: 'auto'}">
    <!-- <ngx-loading [show]="loading1" [config]="{ backdropBorderRadius: '3px' }"></ngx-loading> -->
    <p-header>
        Danh sách in
    </p-header>
    <div class="row">
        <div class="col-md-8 mt-2">
            <div class="field-group select valid">
                <label for="" style="z-index: 2">Danh sách máy in</label>
                <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" [options]="listPrints"
                    [(ngModel)]="modelPrint.PrinterName" name="PrinterName">
                    <ng-template let-item pTemplate="selectedItem">
                        <span style="vertical-align:middle;">{{item.label}}</span>
                    </ng-template>
                    <ng-template let-car pTemplate="item">
                        <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                            <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
            </div>
        </div>
        <div class="col-md-2 mt-2">
            <div class="field-group valid">
                <input type="number" name="Copies" [(ngModel)]="modelPrint.Copies">
                <label for="" style="z-index: 2">Số lần in</label>
            </div>
            <!-- <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" 
                                [options]="soLanIn" [(ngModel)]="modelPrint.Copies" name="Copies" >
                                <ng-template let-item pTemplate="selectedItem">
                                    <span style="vertical-align:middle;">{{item.label}}</span>
                                </ng-template>
                                <ng-template let-car pTemplate="item">
                                    <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                        <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                                    </div>
                                </ng-template>
                            </p-dropdown> -->

            <!-- </div> -->
        </div>
        <div class="col-md-2 mt-2">
            <p-button label="Thực hiện" styleClass="p-button-sm btn-h56 mb-2"
                [disabled]="filesPrints.length === 0 || !modelPrint.PrinterName || modelPrint.Copies === 0 || !modelPrint.Copies"
                (onClick)="openPrint()"></p-button>
        </div>
    </div>


    <div class="grid-default border">
        <app-list-grid-angular *ngIf="columnDefsPrint.length > 0" [listsData]="filesPrints" [domLayout]="'autoHeight'"
            [rowSelection]="'multiple'" [idGrid]="'prints'" (callback)="rowSelected($event)" [detailCellRendererParams]="detailCellRendererParams"
            [columnDefs]="columnDefsPrint"></app-list-grid-angular>
    </div>


    <!-- <div class="row mt-1">
        <div class="group-textarea" [ngClass]="modelAddHoliday?.holi_des ? 'valid' : 'invalid' ">
            <textarea type="text" id="holi_des"  class="form-control" [(ngModel)]="modelAddHoliday.holi_des" cols="30" rows="10" name="holi_des"></textarea>
            <label for="">Mô tả:<span style="color:red">*</span> </label>
        </div>
    </div>
    <div class="row mt-1">
        <div class="d-flex align-items-end" style="width: 100%;">
            <div class="group-dropdown default mb-0">
                <label  for=""> Kiểu lịch: </label>
                <div style="flex-grow: 1">
                    <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false" 
                        [options]="listLich" [(ngModel)]="modelAddHoliday.calendar_type" name="calendar_type" >
                        <ng-template let-item pTemplate="selectedItem">
                            <span style="vertical-align:middle;">{{item.label}}</span>
                        </ng-template>
                        <ng-template let-car pTemplate="item">
                            <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                                <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
            </div>

        </div>
    </div>

    <div class="row mt-1">
        <div class="col-md-6"></div>
        <div class="col-md-6 text-right">
            <p-button label="Cập nhật" icon="pi pi-check" styleClass="p-button-sm mr-1" (click)="updateHoliday()"> </p-button>
            <p-button *ngIf="this.modelAddHoliday.holi_is" label="Hủy ngày nghỉ" icon="pi pi-trash" (click)="FnHuy()" styleClass="p-button-sm p-button-danger mr-1"> </p-button>
            <p-button label="Đóng" icon="pi pi-times" styleClass="p-button-sm p-button-secondary" (click)="displayAddHoliday = !displayAddHoliday"> </p-button>
        </div>
    </div> -->
</p-dialog>

<p-dialog header="{{modelDuyetHopDong.type === 'duyet_ho_so' ? 'Duyệt hồ sơ' : 'Hủy duyệt hồ sơ'}}" [(visible)]="displayApproveContract" [modal]="true" [draggable]="false"
    [resizable]="false" [style]="{width: '40vw'}" [autoZIndex]=true [draggable]="false" [resizable]="false">
    <!-- <div class="row col-md-12 mt-1 select-default" >
        <div class="field-group select label-8">
            <p-dropdown [autoZIndex]="true" [autoDisplayFirst]="false" [style]="{'width': '100%'}" [options]="statusApprover"
            [(ngModel)]="modelDuyetHopDong.status" name="status">
            <ng-template let-item pTemplate="selectedItem">
                <span>{{item.label}}</span>
            </ng-template>
            <ng-template let-car pTemplate="item">
                <div class="ui-helper-clearfix" style="position: relative;height: 25px;">
                    <div style="font-size:14px;float:right;margin-top:4px">{{car.label}}</div>
                </div>
            </ng-template>
            </p-dropdown>
            <label for="">Trạng thái duyệt</label>
        </div>
    </div> -->
    <div class="row col-md-12 mt-1" style="margin-top: 5px;">
        <div class="field-group textarea ">
            <label for="">Ghi chú</label>
            <textarea [(ngModel)]="modelDuyetHopDong.comment" name="comment" cols="30" rows="10" class="form-control"></textarea>
        </div>
    </div>

    <ng-template pTemplate="footer">
        <p-button icon="pi pi-check" *ngIf="modelDuyetHopDong.type === 'duyet_ho_so'" (click)="duyetHoSo()" label="Xác nhận" styleClass=" p-button-sm mr-1">
        </p-button>
        <p-button icon="pi pi-trash" *ngIf="modelDuyetHopDong.type === 'huy_duyet'" (click)="cancelContract()" label="Hủy duyệt" styleClass=" p-button-sm mr-1">
        </p-button>
        <p-button icon="pi pi-times" (click)="displayApproveContract= !displayApproveContract" label="Hủy"
            styleClass="p-button-secondary p-button-sm"></p-button>
    </ng-template>
</p-dialog>

<p-dialog header="Cài đặt cấu hình" [(visible)]="displaySetting" (onHide)="find()" [modal]="true" [style]="{width: '50vw'}" [maximizable]="true"
    [draggable]="false" [resizable]="false" [focusTrap]="false" styleClass="popup-setting">
    <app-config-grid-table-form *ngIf="displaySetting && gridKey" [typeConfig]="'TableInfo'"   [gridKey]="gridKey"></app-config-grid-table-form>
</p-dialog>
