<div class="main-grid">
  <section class="bread-crumb">
    <div class="d-flex bet middle">
        <div class="p-0 col-12 md:col-12 lg:col-3 xl:col-3">
          <app-hrm-breadcrumb [items]="items" ></app-hrm-breadcrumb>
        </div>
        <div class="d-flex end p-0 wrap col-12 md:col-12 lg:col-9 xl:col-9 gap12 middle">
          <div class="filter filter-search p-0 col-4 md:col-4 lg:col-4 xl:col-3">
              <div class="fields search mb-0" [ngClass]=" query.filter ? 'valid' : 'invalid' ">
                  <input placeholder="Tìm kiếm" class="input-default" type="text" autocomplete="off" id="filter"
                      (keydown.enter)="query.offSet = 0; first = 0;load()"
                      [(ngModel)]="query.filter">
                      <span class="placeholder-icon" (click)="query.offSet = 0; first = 0; load()">
                        <svg width="19" height="20" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path fill-rule="evenodd" clip-rule="evenodd" d="M9.02893 0.850098C4.51087 0.850098 0.849609 4.51552 0.849609 9.03539C0.849609 13.5553 4.51087 17.2207 9.02893 17.2207C10.8456 17.2207 12.5254 16.6271 13.8828 15.6241L17.1276 18.8716C17.4984 19.2427 18.0999 19.243 18.4711 18.8721C18.8422 18.5013 18.8425 17.8998 18.4716 17.5286L15.2709 14.3252C16.4787 12.8991 17.2083 11.0518 17.2083 9.03539C17.2083 4.51552 13.547 0.850098 9.02893 0.850098ZM2.74961 9.03539C2.74961 5.56338 5.56169 2.7501 9.02893 2.7501C12.4962 2.7501 15.3083 5.56338 15.3083 9.03539C15.3083 10.8568 14.5355 12.496 13.2976 13.645C12.1765 14.6858 10.6778 15.3207 9.02893 15.3207C5.56169 15.3207 2.74961 12.5074 2.74961 9.03539Z" fill="#2B2F33" fill-opacity="0.6"/>
                          </svg>
                      </span>
              </div>
          </div>
          
          <p-button styleClass="p-button-sm btn-option" (click)="op.toggle($event)">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M0 14V16H6V14H0ZM0 2V4H10V2H0ZM10 18V16H18V14H10V12H8V18H10ZM4 6V8H0V10H4V12H6V6H4ZM18 10V8H8V10H18ZM12 6H14V4H18V2H14V0H12V6Z" fill="#76809B"/>
            </svg>
            <span class="dot"></span>
        </p-button>
        <div class="d-flex gap6" *ngIf="this.isHrDiagram">

          <p-button label="Thêm mới" styleClass="p-button-sm mr-1 " icon="pi pi-plus" (click)="addNew()"></p-button>
         <p-button label="Chỉnh sửa" styleClass="p-button-sm p-button-success" icon="pi pi-check" (click)="chinhSua()"></p-button>
        </div>
        <div class="select-ori ml-1 " (click)="hrDiagram()">
          <div class="dia">
              <svg width="22" height="19" viewBox="0 0 22 19" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M11 0C8.92893 0 7.25 1.67148 7.25 3.73335C7.25 5.54325 8.54366 7.05234 10.2606 7.39415V10.5496H4.49291C4.29682 10.5496 4.10876 10.6272 3.9701 10.7652C3.83144 10.9033 3.75354 11.0905 3.75354 11.2857V14.8684H1.23937C1.04328 14.8684 0.855215 14.946 0.716557 15.084C0.577898 15.2221 0.5 15.4093 0.5 15.6045V17.7639C0.5 17.9591 0.577898 18.1464 0.716557 18.2844C0.855215 18.4224 1.04328 18.5 1.23937 18.5C1.43546 18.5 1.62353 18.4224 1.76218 18.2844C1.90084 18.1464 1.97874 17.9591 1.97874 17.7639V16.3406H7.00709V17.7639C7.00709 17.9591 7.08498 18.1464 7.22364 18.2844C7.3623 18.4224 7.55036 18.5 7.74646 18.5C7.94255 18.5 8.13061 18.4224 8.26927 18.2844C8.40793 18.1464 8.48583 17.9591 8.48583 17.7639V15.6045C8.48583 15.4093 8.40793 15.2221 8.26927 15.084C8.13061 14.946 7.94255 14.8684 7.74646 14.8684H5.23229V12.0218H16.7677V14.8684H14.2535C14.0575 14.8684 13.8694 14.946 13.7307 15.084C13.5921 15.2221 13.5142 15.4093 13.5142 15.6045V17.7639C13.5142 17.9591 13.5921 18.1464 13.7307 18.2844C13.8694 18.4224 14.0575 18.5 14.2535 18.5C14.4496 18.5 14.6377 18.4224 14.7764 18.2844C14.915 18.1464 14.9929 17.9591 14.9929 17.7639V16.3406H20.0213V17.7639C20.0213 17.9591 20.0992 18.1464 20.2378 18.2844C20.3765 18.4224 20.5645 18.5 20.7606 18.5C20.9567 18.5 21.1448 18.4224 21.2834 18.2844C21.4221 18.1464 21.5 17.9591 21.5 17.7639V15.6045C21.5 15.4093 21.4221 15.2221 21.2834 15.084C21.1448 14.946 20.9567 14.8684 20.7606 14.8684H18.2465V11.2857C18.2465 11.0905 18.1686 10.9033 18.0299 10.7652C17.8912 10.6272 17.7032 10.5496 17.5071 10.5496H11.7394V7.39415C13.4563 7.05234 14.75 5.54325 14.75 3.73335C14.75 1.67148 13.0711 0 11 0Z" fill="#0979FD"/>
              </svg>
          </div>
        </div>
        <p-button  (click)="menuButton.toggle($event)" label="Cài đặt" icon="pi pi-cog" styleClass="p-button-sm "></p-button>
        </div>
     
    </div>
  </section>

  <!-- <section >
    <p-organizationChart [value]="listAgencyMap"
        #mydiv  [preserveSpace]="false" selectionMode="single" 
        [(selection)]="selectedNode"
        styleClass="company">
        <ng-template let-node pTemplate="person">
            <div class="node-header p-corner-top">{{node.data.position ? node.data.position : 'No position'}}</div>
            <div class="node-content">
                <img src="{{node.data.avatarUrl ? node.data.avatarUrl : '../../../../../assets/images/img_avatar.png'}}" width="32">
                <div>{{node.data.full_name ? node.data.full_name : 'No name'}}</div>
            </div>
        </ng-template>
        <ng-template let-node pTemplate="department" >
            {{node.label}}
        </ng-template>
    </p-organizationChart>
  </section> -->
  <section>
      <div class="section-box pt-0 pb-0" #container *ngIf="!this.isHrDiagram">
            <app-list-grid-tree-angular 
            *ngIf="columnDefs.length > 0 && autoGroupColumnDef && getDataPath"  
            (callback)="rowSelected($event)"  
            (onCellClicked)="onCellClicked($event)"  
            (showConfig)="cauhinh()"
              [listsData]="listsData" 
              [height]="heightGrid" 
              [getDataPath]="getDataPath"
              [columnDefs]="columnDefs"></app-list-grid-tree-angular>
              <app-loading-grid  [gridtype]="'lhd'" *ngIf="columnDefs.length === 0" [columnNumber]="11"></app-loading-grid>
            <div class="paginator">
            <span>Từ {{ countRecord.currentRecordStart }} đến
                {{ countRecord.currentRecordEnd }}
                trên tổng số
                {{ countRecord.totalRecord }} kết quả</span>
            <p-paginator [rows]="query.pageSize" [totalRecords]="countRecord.totalRecord" [first]="first"
                (onPageChange)="paginate($event)" [rowsPerPageOptions]="[20,40,60,100,200,{ showAll: 'ALL' }]">
            </p-paginator>
        </div>
      </div>
      <div class="section-box pt-0 pb-0" *ngIf="this.isHrDiagram">

        <div style="position: absolute; top: 150px; bottom: 0; left: 0; right: 0;">

            <pan-zoom [config]="panZoomConfig">
      
              <div style="position: relative;">
      
                                <p-organizationChart 
                        [value]="listAgencyMap" #mydiv  
                        [preserveSpace]="false" 
                        selectionMode="single" 
                        [(selection)]="selectedNode" 
                        (onNodeSelect)="onNodeSelect($event)"
                                styleClass="company">
                                <ng-template let-node pTemplate="person">
                                    <div class="node-header p-corner-top">{{node.data.position ? node.data.position : 'No position'}}</div>
                                    <div class="node-content">
                                        <img src="{{node.data.avatarUrl ? node.data.avatarUrl : '../../../../../assets/images/img_avatar.png'}}" width="32">
                                        <div>{{node.data.full_name ? node.data.full_name : 'No name'}}</div>
                                    </div>
                                </ng-template>
                                <ng-template let-node pTemplate="department" >
                                    {{node.label}}
                                </ng-template>
                            </p-organizationChart>
              </div>
            </pan-zoom>
          </div>
      </div>
    </section>
</div>


<!-- <p-dialog [(visible)]="displayOrganize" [draggable]="false" [resizable]="false"  [modal]="true" [style]="{width: modelOrganize.orgId ? '1400px' : '700px', height: 'auto'}">
    <p-header>
        {{modelOrganize.orgId ? 'Thông tin chi tiết tổ chức' : 'Thêm mới tổ chức'}}
    </p-header>
    <app-chi-tiet-to-chuc [orgId]="modelOrganize.orgId" [parentId]="modelOrganize.parentId" [isDialog]="true" *ngIf="displayOrganize" (back)="backPage()"></app-chi-tiet-to-chuc>
</p-dialog> -->

<p-sidebar
    [style]="{ width: '80%' }"
    [(visible)]="displayOrganize" 
    position="right">
    <ng-template pTemplate="header">
      <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
          <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
      </svg> &nbsp;&nbsp;
      {{modelOrganize.orgId ? 'Thông tin chi tiết tổ chức' : 'Thêm mới tổ chức'}}</ng-template>
      <app-chi-tiet-to-chuc [orgId]="modelOrganize.orgId" [parentId]="modelOrganize.parentId" [isDialog]="true" *ngIf="displayOrganize" (back)="backPage()"></app-chi-tiet-to-chuc>
</p-sidebar>
<p-sidebar
    [style]="{ width: '80%' }"
    [(visible)]="displayButton" 
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Chức năng </ng-template>
    <ng-template pTemplate="footer"></ng-template>
    <div class="row d-flex justify-content-center"> 
        <p-button label="Danh sách phòng ban" (click)="getlistnv()" styleClass="p-button-sm mr-1 p-button-info" icon="pi pi-eye"></p-button>
        <p-button label="Thêm mới phòng ban" (click)="Add()" styleClass="p-button-sm mr-1" icon="pi pi-plus"></p-button>
        <p-button label="Chỉnh sửa phòng ban" (click)="Edit()" styleClass="p-button-sm mr-1" icon="pi pi-pencil"></p-button>
        <p-button label="Xóa phòng ban" (click)="Delete()" *ngIf="detailOrganizeMap?.parentId > 0" styleClass="p-button-sm p-button-danger" icon="pi pi-trash"></p-button>
       </div>
</p-sidebar>

<p-dialog header="Cài đặt cấu hình" [(visible)]="displaySetting" (onHide)="find()" [modal]="true" [style]="{width: '50vw'}" [maximizable]="true"
    [draggable]="false" [resizable]="false" [focusTrap]="false" styleClass="popup-setting">
    <app-config-grid-table-form *ngIf="displaySetting && gridKey" [typeConfig]="'TableInfo'"   [gridKey]="gridKey"></app-config-grid-table-form>
</p-dialog>
<p-overlayPanel #op [dismissable]="false" [style]="{width: '40rem'}" appendTo="body" >
  <ng-template pTemplate>
      <app-form-filter *ngIf="listViewsFilter.length > 0" 
          [listFields]="listViewsFilter" 
          [detailInfoFilter]="detailInfoFilter" 
          [buttonsFilters] ="optionsButonFilter" 
          (callback)="filterLoad($event)" 
          (close)="close($event);op.hide()"></app-form-filter>
  </ng-template>
</p-overlayPanel>

<p-menu [model]="menuItem" [appendTo]="'body'"  [popup]="true" #menuButton></p-menu>

<!-- <p-dialog  [maximizable]="true"
    header="Sơ đồ tổ chức"
  styleClass="hr-diagram" 
  [appendTo]="'body'" 
  [autoZIndex]="true" 
  [(visible)]="isHrDiagram" 
  [modal]="true" 
  [breakpoints]="{'1024': '95vw', '640px': '100vw'}" 
  [style]="{width: '98vw'}">
 
</p-dialog> -->
