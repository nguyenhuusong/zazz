<div class="main-grid">
    <section class="bread-crumb">
        <div class="d-flex bet middle wrap">
            <div class="p-0 col-12 md:col-12 lg:col-3 xl:col-3">
                <app-hrm-breadcrumb [items]="items" ></app-hrm-breadcrumb>
            </div>
            <div class="d-flex end p-0 wrap col-12 md:col-12 lg:col-9 xl:col-9 gap12">
                <div class="filter filter-search p-0 col-4 md:col-4 lg:col-4 xl:col-3">
                    <div class="fields search mb-0" [ngClass]=" query.filter ? 'valid' : 'invalid' ">
                        <input placeholder="Họ tên, số điện thoại, email..." class="input-default" type="text" autocomplete="off" id="filter"
                        (keydown.enter)="query.offSet = 0; first = 0;load()"
                            [(ngModel)]="query.filter">
                            <span class="placeholder-icon" (click)="query.offSet = 0; first = 0; load()">
                                <svg width="19" height="20" viewBox="0 0 19 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M9.02893 0.850098C4.51087 0.850098 0.849609 4.51552 0.849609 9.03539C0.849609 13.5553 4.51087 17.2207 9.02893 17.2207C10.8456 17.2207 12.5254 16.6271 13.8828 15.6241L17.1276 18.8716C17.4984 19.2427 18.0999 19.243 18.4711 18.8721C18.8422 18.5013 18.8425 17.8998 18.4716 17.5286L15.2709 14.3252C16.4787 12.8991 17.2083 11.0518 17.2083 9.03539C17.2083 4.51552 13.547 0.850098 9.02893 0.850098ZM2.74961 9.03539C2.74961 5.56338 5.56169 2.7501 9.02893 2.7501C12.4962 2.7501 15.3083 5.56338 15.3083 9.03539C15.3083 10.8568 14.5355 12.496 13.2976 13.645C12.1765 14.6858 10.6778 15.3207 9.02893 15.3207C5.56169 15.3207 2.74961 12.5074 2.74961 9.03539Z" fill="#2B2F33" fill-opacity="0.6"/>
                                    </svg>
                            </span>
                    </div>
                </div>
                <p-button styleClass="p-button-sm btn-option" (click)="op.toggle($event)">
                    <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 14V16H6V14H0ZM0 2V4H10V2H0ZM10 18V16H18V14H10V12H8V18H10ZM4 6V8H0V10H4V12H6V6H4ZM18 10V8H8V10H18ZM12 6H14V4H18V2H14V0H12V6Z" fill="#76809B"/>
                    </svg>
                    <span class="dot"></span>
                </p-button>
                <p-button styleClass="p-button-sm" icon="pi pi-plus" label="Thêm mới" (click)="addTuyenDung()"></p-button>
                <p-button type="button" styleClass="box-icon" (click)="getRecruitActions();optionsButton.toggle($event)" icon="uni-icon uni-dots" label=""></p-button>
           </div>
        </div>
    </section>

    <section class="content">
        <div class="grid-default" #container>
            <app-list-grid-angular *ngIf="columnDefs.length > 0" [listsData]="listsData" [height]="heightGrid"
                (callback)="rowSelected($event)"
                (onCellClicked)="onCellClicked($event)"
                [rowSelection]="'multiple'"
                (showConfig)="cauhinh()"
                [idGrid]="gridKey + '_45dfs'"
                [columnDefs]="columnDefs"></app-list-grid-angular>
                <app-loading-grid  [gridtype]="'lhd'" *ngIf="columnDefs?.length === 0" [columnNumber]="11"></app-loading-grid>
            <div class="paginator">
                <span>Từ {{ countRecord.currentRecordStart }} đến
                    {{ countRecord.currentRecordEnd }}
                    trên tổng số
                    {{ countRecord.totalRecord }} kết quả</span>
                <p-paginator [rows]="query.pageSize" [totalRecords]="countRecord.totalRecord" [first]="first"
                    (onPageChange)="paginate($event)" [rowsPerPageOptions]="[20,40,60,100,200,{ showAll: 'ALL' }]">
                </p-paginator>
            </div>
        </div>
    </section>
</div>

<p-dialog header="Cài đặt cấu hình" [(visible)]="displaySetting" (onHide)="find()" [modal]="true" [style]="{width: '50vw'}" [maximizable]="true"
    [draggable]="false" [resizable]="false" [focusTrap]="false" styleClass="popup-setting">
    <app-config-grid-table-form *ngIf="displaySetting && gridKey" [typeConfig]="'TableInfo'"   [gridKey]="gridKey"></app-config-grid-table-form>
</p-dialog>

<p-overlayPanel #recru [style]="{width: '400px'}" styleClass="advance-seach">
    <ng-template pTemplate>
        <div class="header-filter-search  grid">
            <h3>Chuyển vòng tuyển</h3>
        </div>
        <div class="header-filter-search  mt-1">
            <div class="icon col-12 pl-0">
                <div class="radios grid" *ngIf="recruitmentStatus.length > 0 && canSttValue">
                    <div [ngClass]="canSttValue.can_st > recrui.code ? 'op6' : ''" class="p-field-radiobutton col-6" style="margin-bottom: 5px;" *ngFor="let recrui of recruitmentStatus">
                        <p-radioButton
                            [disabled]="canSttValue.can_st > recrui.code"
                            name="recrui" value="{{ recrui.code }}" 
                            [(ngModel)]="recruitmentStatusSelected" 
                            inputId="recrui{{ recrui.code }}"></p-radioButton>
	                    <label style="margin-left: 5px;" for="recrui{{ recrui.code }}">{{ recrui.label }}</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="input-group icon col-12 select-default text-right">
            <p-button label="Hủy" icon="pi pi-times" (click)="recru.hide()" 
                styleClass="p-button-secondary">
            </p-button>
            &nbsp;
            <p-button label="Chuyển" [disabled]="recruitmentStatusSelected ? false : true" 
            icon="pi pi-times" (click)="changeRecruStatus()"
                styleClass="">
            </p-button>
        </div>
    </ng-template>
</p-overlayPanel>

<!-- sentEmail: gửi email thành công -->
<p-sidebar
styleClass="hideHeaderForm"
    [style]="{ width: '600px' }"
    [(visible)]="isSendMail" 
    (onHide)="onHideSendEmail($event)"
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        {{ sentEmail ? 'Gửi mail Thành công' : 'Gửi mail' }} </ng-template>
        <div class="fields" *ngIf="!sentEmail">
            <label>Nội dung gửi <span style="color: red">*</span></label>
            <p-dropdown appendTo="body" [baseZIndex]="100" [autoDisplayFirst]="false"
            [options]="mailsInput" placeholder="Chọn nội dung gửi" [(ngModel)]="mailInputValue" name="mailInputValue">
            </p-dropdown>
        </div>
            <p-button *ngIf="sentEmail" icon="pi pi-calendar" (click)="themLichHop()" label="Thêm lịch họp"></p-button>
            <ng-template pTemplate="footer">
                <div class="d-flex end" *ngIf="!sentEmail">
                  <p-button (click)="cancelSendEmail()" styleClass="p-button-sm p-button-secondary" label="Bỏ qua" icon="pi pi-times-circle"></p-button>&nbsp;
                  <p-button (click)="sendEmail()" [CheckHideActions]="{url:  MENUACTIONROLEAPI.GetCandidatePage.url, action: ACTIONS.SEND_EMAIL}">Gửi email</p-button>
                </div>
            </ng-template>
</p-sidebar>

<p-sidebar
styleClass="hideHeaderForm"
    [style]="{ width: '80%' }"
    [(visible)]="isRateRecui" 
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Đánh giá</ng-template>
        <div class="d-flex gap16 mb-3">
            <div class="fields radio">
                <p-radioButton
                    name="recrui" value="1" 
                    [(ngModel)]="queryRate.InterviewResult" 
                    inputId="rate-good"></p-radioButton>
                <label for="rate-good"> &nbsp;Tốt</label>
            </div>
            <div class="fields radio">
                <p-radioButton
                    name="recrui" value="2" 
                    [(ngModel)]="queryRate.InterviewResult" 
                    inputId="rate-bad"></p-radioButton>
                    <label for="rate-bad"> &nbsp;Không tốt</label>
            </div>
    </div>
        <div class="field-group">
            <div class="alert-validation alert-danger" *ngIf="!rateStatus && isSubmitRate"> 
                Vui lòng chọn đánh giá
            </div>
        </div>
        <ng-template pTemplate="footer">
            <div class="d-flex end">
            <p-button (click)="cancelRate()" styleClass="p-button-sm p-button-secondary" label="Bỏ qua" icon="pi pi-times-circle"></p-button>&nbsp;
            <p-button (click)="sendRate()">Gửi Đánh giá</p-button>
            </div>
        </ng-template>
</p-sidebar>

<p-sidebar
    [style]="{ width: '80%' }"
    styleClass="hideHeaderForm"
    [(visible)]="isTiemNang" 
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Tiềm năng </ng-template>
    <div class="field-group textarea">
        <textarea placeholder="Nhập lý do" [(ngModel)]="queryTiemNang.reason_rejiect" required></textarea>
    </div>
       <div class="field-group">
            <div class="alert-validation alert-danger" *ngIf="!queryTiemNang.reason_rejiect && isSubmitTiemNang"> 
                Vui lòng nhập lý do
            </div>
        </div>
        <ng-template pTemplate="footer">
            <div class="d-flex end">
              <p-button (click)="canSetTiemNang()" styleClass="p-button-sm p-button-secondary" label="Bỏ qua" icon="pi pi-times-circle"></p-button>&nbsp;
              <p-button (click)="setTiemNang()">Gửi</p-button>
            </div>
        </ng-template>
</p-sidebar>

<p-sidebar
    [style]="{ width: '400px' }"
    styleClass="hideHeaderForm"
    [(visible)]="isChuyenVong" 
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Chuyển vòng tuyển </ng-template>
    <ng-template pTemplate="footer"></ng-template>
        <div class="header-filter-search  mt-1">
            <div class="icon col-12 pl-0">
                <div class="radios grid">
                    <div class="p-field-radiobutton col-6" style="margin-bottom: 5px;" *ngFor="let recrui of recruitmentStatus">
                        <p-radioButton
                            name="recrui" value="{{ recrui.value }}" 
                            [(ngModel)]="recruitmentStatusSelected" 
                            inputId="recrui{{ recrui.value }}"></p-radioButton>
                        <label style="margin-left: 5px;" for="recrui{{ recrui.value }}">{{ recrui.name }}</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="input-group icon col-12 select-default text-right">
            <p-button label="Hủy" icon="pi pi-times" (click)="isChuyenVong = false" 
                styleClass="p-button-secondary">
            </p-button>
            &nbsp;
            <p-button label="Chuyển" [disabled]="recruitmentStatusSelected ? false : true" 
            icon="pi pi-times" (onClick)="changeRecruStatus()"
                styleClass="">
            </p-button>
        </div>
</p-sidebar>

<p-menu [model]="buttonTiemNang" [appendTo]="'body'" [popup]="true"
        styleClass="menu-option-right" #tiemnangButton></p-menu>

<p-menu [model]="optionsButtonDB" [appendTo]="'body'" [popup]="true"
styleClass="menu-option-right p-menu-group" #optionsButton></p-menu>

<p-sidebar
styleClass="isUploadImage"
    [style]="{ width: '80%' }"
    [(visible)]="isUploadImage" 
    (onHide)="onHideSendEmail($event)"
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Upload ảnh </ng-template>
        <ng-template pTemplate="footer"></ng-template>
        <div class="fields">
            <p-fileUpload mode="basic" 
            name="demo[]" 
            chooseLabel="Tạo mới import" accept="image/*" (onSelect)="onSelectFile($event, 1)"></p-fileUpload>
        </div>
        <div class="fields">
            <p-fileUpload mode="basic" 
            name="demo[]" 
            chooseLabel="Tạo mới import" accept="image/*" (onSelect)="onSelectFile($event, 2)"></p-fileUpload>
        </div>
        <p-button styleClass="p-button-sm p-button-secondary" (click)="sendImages()" icon="pi pi-times" label="Gửi ảnh"></p-button>
</p-sidebar>

<p-overlayPanel #op [style]="{'width': '40rem'}" [dismissable]="false" appendTo="body" >
    <ng-template pTemplate>
        <app-form-filter *ngIf="listViewsFilter.length > 0" [listFields]="listViewsFilter" [hiddenButtonClose]="true" [detailInfoFilter]="detailInfoFilter" [buttonsFilters] ="optionsButonFilter" (callback)="filterLoad($event);op.hide()" (close)="close($event);op.hide()"></app-form-filter>
    </ng-template>
</p-overlayPanel>

<p-sidebar
    [style]="{ width: '80%' }"
    [(visible)]="displayAddCCCD" 
    position="right">
    <ng-template pTemplate="header">
        <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.41 0L0 1.41L4.58 6L0 10.59L1.41 12L7.41 6L1.41 0Z" fill="#2B2F33"/>
            <path d="M8 0L6.59 1.41L11.17 6L6.59 10.59L8 12L14 6L8 0Z" fill="#2B2F33"/>
        </svg> &nbsp;&nbsp;
        Tải lên CCCD,  Hộ chiếu </ng-template>
    <ng-template pTemplate="footer"></ng-template>
    <app-cung-cap-cccd *ngIf="displayAddCCCD" [canId]="canId" (callback)="saveCCCD()"></app-cung-cap-cccd>
</p-sidebar>